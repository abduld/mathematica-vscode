{
    "name": "Mathematica",
    "scopeName": "source.mathematica",
    "fileTypes": [".m", ".wl"],
    "patterns": [
        {"include": "#comments"},
        {"include": "#expressions"},
        {"include": "#part"}
    ],
    "repository":{
        "comments": {
            "patterns": [
                {
                    "comment": "Comment",
                    "begin": "\\(\\*",
                    "beginCaptures": {"0": {"name": "punctuation.definition.comment"}},
                    "end": "\\*\\)",
                    "endCaptures": {"0": {"name": "punctuation.definition.comment"}},
                    "name": "comment.block",
                    "patterns": [{"include": "$self"}]
                }
            ]
        },
        "expressions": {
            "patterns": [
                {"include": "#strings"},
                {"include": "#numbers"},
                {"include": "#other_functions"},
                {"include": "#full_expr"},
                {"include": "#message"},
                {"include": "#pattern"},
                {"include": "#query"}

            ]
        },
        "full_expr": {
            "comment": "Full expression forms",
            "patterns": [
                {
                    "comment": "Standard form",
                    "match": "([0-9\\.]*)([A-Za-z\\$][A-Za-z0-9\\$]*`)?([A-Za-z\\$][A-Za-z0-9\\$]*)\\s*(\\[)(?!\\[)",
                    "captures": {
                        "1": {"name": "constant.numeric"},
                        "2": {"name": "support.class"},
                        "3": {"name": "support.function"}
                    }
                },
                {
                    "comment": "Prefix form",
                    "match": "([0-9\\.]*)([A-Za-z\\$][A-Za-z0-9\\$]*`)?([A-Za-z\\$][A-Za-z0-9\\$]*)\\s*(@)",
                    "captures": {
                        "1": {"name": "constant.numeric"},
                        "2": {"name": "support.class"},
                        "3": {"name": "support.function"},
                        "4": {"name": "keyword.operator"}
                    }
                },
                {
                    "comment": "Infix form",
                    "match": "\\s*(~)\\s*([A-Za-z\\$][A-Za-z0-9\\$]*`)?([A-Za-z\\$][A-Za-z0-9\\$]*)\\s*(~)\\b\\s*",
                    "captures": {
                        "1": {"name": "keyword.operator"},
                        "2": {"name": "support.class"},
                        "3": {"name": "support.function"},
                        "4": {"name": "keyword.operator"}
                    }
                },
                {
                    "comment": "Postfix form",
                    "match": "(//)\\s*([A-Za-z\\$][A-Za-z0-9\\$]*`)?([A-Za-z\\$][A-Za-z0-9\\$]*)\\b",
                    "captures": {
                        "1": {"name": "keyword.operator"},
                        "2": {"name": "support.class"},
                        "3": {"name": "support.function"}
                    }
                }
            ]
        },
        "other_functions": {
            "comment": "Other function highlights.",
            "patterns": [
                {
                    "comment": "Compositions of functions",
                    "match": "([A-Za-z\\$][A-Za-z0-9\\$]*`)?([A-Za-z\\$][A-Za-z0-9\\$]*)\\s*(@\\*|/\\*)\\s*([A-Za-z\\$][A-Za-z0-9\\$]*`)?([A-Za-z\\$][A-Za-z0-9\\$]*)",
                    "captures": {
                        "1": {"name": "support.class"},
                        "2": {"name": "support.function"},
                        "3": {"name": "keyword.operator"},
                        "4": {"name": "support.class"},
                        "5": {"name": "support.function"}}
                },
                {
                    "comment": "MapAll expression",
                    "match": "([0-9\\.]*)([A-Za-z\\$][A-Za-z0-9\\$]*`)?([A-Za-z\\$][A-Za-z0-9\\$]*)\\s*(//@)",
                    "captures": {
                        "1": {"name": "constant.numeric"},
                        "2": {"name": "support.class"},
                        "3": {"name": "support.function"},
                        "4": {"name": "keyword.operator"}
                    }
                },
                {
                    "comment": "Map expression",
                    "match": "([0-9\\.]*)([A-Za-z\\$][A-Za-z0-9\\$]*`)?([A-Za-z\\$][A-Za-z0-9\\$]*)\\s*(/@)",
                    "captures": {
                        "1": {"name": "constant.numeric"},
                        "2": {"name": "support.class"},
                        "3": {"name": "support.function"},
                        "4": {"name": "keyword.operator"}
                    }
                },
                {
                    "comment": "Apply expression",
                    "match": "([0-9\\.]*)([A-Za-z\\$][A-Za-z0-9\\$]*`)?([A-Za-z\\$][A-Za-z0-9\\$]*)\\s*(@@@)",
                    "captures": {
                        "1": {"name": "constant.numeric"},
                        "2": {"name": "support.class"},
                        "3": {"name": "support.function"},
                        "4": {"name": "keyword.operator"}
                    }
                },
                {
                    "comment": "Apply expression",
                    "match": "([0-9\\.]*)([A-Za-z\\$][A-Za-z0-9\\$]*`)?([A-Za-z\\$][A-Za-z0-9\\$]*)\\s*(@@)",
                    "captures": {
                        "1": {"name": "constant.numeric"},
                        "2": {"name": "support.class"},
                        "3": {"name": "support.function"},
                        "4": {"name": "keyword.operator"}
                    }
                }
            ]
        },
        "message": {
            "patterns": [
                {
                    "match": "\\b([A-Za-z\\$][A-Za-z0-9\\$]*)\\s*(::)\\s*([A-Za-z\\$][A-Za-z0-9\\$]*)\\b",
                    "captures": {
                        "1": {"name": "entity.name.function"},
                        "2": {"name": "keyword.operator"},
                        "3": {"name": "string.unquoted"}
                    }
                }
            ]
        },
        "pattern": {
            "patterns": [
                {
                    "match": "\\b([A-Za-z\\$][A-Za-z0-9\\$]*)?(_\\.|_{1,3})([A-Za-z\\$][A-Za-z0-9\\$]*)?(\\.{2, 3})?(\\s*\\?\\s*[A-Za-z\\$][A-Za-z0-9\\$]*)?",
                    "name": "variable.parameter"
                }
            ]
        },
        "query": {
            "patterns": [
                {
                    "match": "(\\?)\\s*([A-Za-z\\$][A-Za-z0-9\\$]*`)?([A-Za-z\\$][A-Za-z0-9\\$]*)",
                    "captures": {
                        "1": {"name": "keyword.operator"},
                        "2": {"name": "support.class"},
                        "3": {"name": "entity.name.function"}
                    }
                }
            ]
        },
        "strings": {
			"patterns": [
				{
					"begin": "\"",
					"beginCaptures": {
						"0": {
							"name": "punctuation.definition.string.begin"
						}
					},
					"end": "\"",
					"endCaptures": {
						"0": {
							"name": "punctuation.definition.string.end"
						}
					},
					"name": "string.quoted.double",
					"patterns": [
						{
							"include": "#string_escaped_char"
						},
						{
							"include": "#line_continuation_character"
						}
					]
				}
			]
		},
		"string_escaped_char": {
			"patterns": [
				{
					"match": "(?x)\\\\ (\n\\\\             |\n[abefnprtv'\"?]   |\n[0-3]\\d{,2}     |\n[4-7]\\d?        |\nx[a-fA-F0-9]{,2} |\nu[a-fA-F0-9]{,4} |\nU[a-fA-F0-9]{,8} )",
					"name": "constant.character.escape"
				},
				{
					"match": "\\\\.",
					"name": "invalid.illegal.unknown-escape"
				}
			]
		},
        "line_continuation_character": {
			"patterns": [
				{
					"match": "(\\\\)\\n",
					"captures": {
						"1": {
							"name": "constant.character.escape.line-continuation"
						}
					}
				}
			]
		},
        "numbers": {
            "patterns": [
                {
                    "comment": "Reals",
                    "match": "(\\b|\\b[0-9]+\\^\\^)([0-9]+\\.[0-9]*|\\.[0-9]+)",
                    "name": "constant.numeric"
                },
                {
                    "comment": "Integers",
                    "match": "(\\b|\\b[0-9]+\\^\\^)[0-9]+",
                    "name": "constant.numeric"
                }
            ]
        },
        "part": {
            "patterns": [
                {
                    "begin": "\\[\\[|〚",
                    "beginCaptures": {"0": {"name": "keyword.operator"}},
                    "end": "\\]\\]|〛",
                    "endCaptures": {"0": {"name": "keyword.operator"}},
                    "patterns": [
                        {"include": "#expressions"},
                        {"include": "#span"},
                        {"include": "$self"}
                    ]
                }
            ]
        },
        "span": {
            "patterns": [
                {
                    "match": ";;",
                    "name": "keyword.operator"
                }
            ]
        },
        "operators": {
            "patterns": [
                {
                    "comment": "Get operator",
                    "match": "\\<\\<",
                    "name": "keyword.operator"
                },
                {
                    "comment": "Script control operators",
                    "match": "\\\\(&|\\+|%|\\_|!)",
                    "name": "keyword.operator"
                },
                {
                    "comment": "Pattern test",
                    "match": "\\?",
                    "name": "keyword.operator"
                },
                {
                    "comment": "Increment",
                    "match": "\\+\\+",
                    "name": "keyword.operator.increment"
                },
                {
                    "comment": "Decrement",
                    "match": "--",
                    "name": "keyword.operator.decrement"
                },
                {
                    "comment": "Composition",
                    "match": "@\\*|/\\*",
                    "name": "keyword.operator"
                },

                {
                    "comment": "~ sign",
                    "match": "~",
                    "name": "keyword.operator"
                },
                {
                    "comment": "Map",
                    "match": "/@",
                    "name": "keyword.operator"
                },
                {
                    "comment": "MapAll",
                    "match": "//@",
                    "name": "keyword.operator"
                },
                {
                    "comment": "@ sign",
                    "match": "@",
                    "name": "keyword.operator"
                }
            ]
        }
    }
}